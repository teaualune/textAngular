!function(a,b){b["true"]=a,angular.module("textAngularSetup",[]).value("taOptions",{toolbar:[["redo","undo"],["h1","p","bold","italics","underline","strikeThrough","ul","ol","insertLink"]],classes:{focussed:"ta-focussed",toolbar:"ta-toolbar",toolbarGroup:"ta-button-group",toolbarButton:"ta-toolbar-button",toolbarButtonActive:"ta-toolbar-button-active",disabled:"ta-toolbar-button-disabled",textEditor:"form-control",htmlEditor:"form-control"},setup:{textEditorSetup:angular.noop,htmlEditorSetup:angular.noop}}).constant("taTranslations",{insertLink:"URL...",h1:{tooltip:"Heading"},p:{tooltip:"Paragraph"},undo:{tooltip:"Undo"},redo:{tooltip:"Redo"},ul:{tooltip:"Unordered List"},ol:{tooltip:"Ordered List"},bold:{tooltip:"Bold"},italic:{tooltip:"Italic"},underline:{tooltip:"Underline"},strikeThrough:{tooltip:"Strikethrough"}}).run(["taRegisterTool","$window","taTranslations",function(a,b,c){a("h1",{iconclass:"fa fa-header",tooltiptext:c.h1.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<H1>")},activeState:function(){return function(){return this.$editor().queryFormatBlockState("h1")}}}),a("p",{iconclass:"fa fa-paragraph",tooltiptext:c.p.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),a("ul",{iconclass:"fa fa-list-ul",tooltiptext:c.ul.tooltip,action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertUnorderedList")}}),a("ol",{iconclass:"fa fa-list-ol",tooltiptext:c.ol.tooltip,action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertOrderedList")}}),a("undo",{iconclass:"fa fa-undo",tooltiptext:c.undo.tooltip,action:function(){return this.$editor().wrapSelection("undo",null)}}),a("redo",{iconclass:"fa fa-repeat",tooltiptext:c.redo.tooltip,action:function(){return this.$editor().wrapSelection("redo",null)}}),a("bold",{iconclass:"fa fa-bold",tooltiptext:c.bold.tooltip,action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return this.$editor().queryCommandState("bold")},commandKeyCode:98}),a("italics",{iconclass:"fa fa-italic",tooltiptext:c.italic.tooltip,action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return this.$editor().queryCommandState("italic")},commandKeyCode:105}),a("underline",{iconclass:"fa fa-underline",tooltiptext:c.underline.tooltip,action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return this.$editor().queryCommandState("underline")},commandKeyCode:117}),a("strikeThrough",{iconclass:"fa fa-strikethrough",action:function(){return this.$editor().wrapSelection("strikeThrough",null)},activeState:function(){return document.queryCommandState("strikeThrough")}}),a("insertLink",{tooltiptext:c.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var a;return a=b.prompt(c.insertLink.dialogPrompt,"http://"),a&&""!==a&&"http://"!==a?this.$editor().wrapSelection("createLink",a,!0):void 0},activeState:function(a){return a?"A"===a[0].tagName:!1},onElementSelect:{element:"a",action:function(a,d,e){a.preventDefault(),e.displayElements.popover.css("width","435px");var f=e.displayElements.popoverContainer;f.empty(),f.css("line-height","28px");var g=angular.element('<a href="'+d.attr("href")+'" target="_blank">'+d.attr("href")+"</a>");g.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),f.append(g);var h=angular.element('<div class="pull-right">'),i=angular.element('<button class="ta-toolbar-button" tabindex="-1" unselectable="on"><i class="fa fa-edit icon-edit"></i></button>');i.on("click",function(a){a.preventDefault();var f=b.prompt(c.insertLink.dialogPrompt,d.attr("href"));f&&""!==f&&"http://"!==f&&(d.attr("href",f),e.updateTaBindtaTextElement()),e.hidePopover()}),h.append(i);var j=angular.element('<button class="ta-toolbar-button" tabindex="-1" unselectable="on"><i class="fa fa-unlink icon-unlink"></i></button>');j.on("click",function(a){a.preventDefault(),d.replaceWith(d.contents()),e.updateTaBindtaTextElement(),e.hidePopover()}),h.append(j),f.append(h),e.showPopover(d)}}})}]),function(){"Use Strict";function a(a){try{return 0!==angular.element(a).length}catch(b){return!1}}function b(a,c){var d=[],e=a.children();return e.length&&angular.forEach(e,function(a){d=d.concat(b(angular.element(a),c))}),void 0!==a.attr(c)&&d.push(a),d}function c(b,c){if(!b||""===b||o.hasOwnProperty(b))throw"textAngular Error: A unique name is required for a Tool Definition";if(c.display&&(""===c.display||!a(c.display))||!c.display&&!c.buttontext&&!c.iconclass)throw'textAngular Error: Tool Definition for "'+b+'" does not have a valid display/iconclass/buttontext value';o[b]=c}var d=!1;/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&(document.addEventListener("click",function(a){var b=a||window.event,c=b.target;if(d&&null!==c){for(var e=!1,f=c;null!==f&&"html"!==f.tagName.toLowerCase()&&!e;)e="true"===f.contentEditable,f=f.parentNode;e||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),c.focus())}d=!1},!1),angular.element(document).ready(function(){angular.element(document.body).append(angular.element('<input id="textAngular-editableFix-010203040506070809" style="width:1px;height:1px;border:none;margin:0;padding:0;position:absolute; top: -10000px; left: -10000px;" unselectable="on" tabIndex="-1">'))}));var e=function(){var a,b=-1,c=window.navigator.userAgent,d=c.indexOf("MSIE "),e=c.indexOf("Trident/");if(d>0)b=parseInt(c.substring(d+5,c.indexOf(".",d)),10);else if(e>0){var f=c.indexOf("rv:");b=parseInt(c.substring(f+3,c.indexOf(".",f)),10)}return b>-1?b:a}();String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var f,g,h,i,j;if(e>8||void 0===e){for(var k,l=document.styleSheets,m=0;m<l.length;m++)if((0===l[m].media.length||l[m].media.mediaText.match(/(all|screen)/gi))&&l[m].href){if(l[m].href.match(/textangular\.(min\.|)css/gi)){f=l[m];break}k=l[m]}!f&&k?f=k:f||(f=function(){var a=document.createElement("style");return/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&a.appendChild(document.createTextNode("")),document.head.appendChild(a),a.sheet}()),g=function(a,b){i(f,a,b)},i=function(a,b,c){var d;return a.rules?d=Math.max(a.rules.length-1,0):a.cssRules&&(d=Math.max(a.cssRules.length-1,0)),a.insertRule?a.insertRule(b+"{"+c+"}",d):a.addRule(b,c,d),d},h=function(a){j(f,a)},j=function(a,b){a.removeRule?a.removeRule(b):a.deleteRule(b)}}var n=angular.module("textAngular",["ngSanitize","textAngularSetup"]),o={};n.constant("taRegisterTool",c),n.value("taTools",o),n.config([function(){angular.forEach(o,function(a,b){delete o[b]})}]),n.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log","$q",function(a,b,c,d,e,f,g,h,i){return{require:"?ngModel",scope:{},restrict:"EA",link:function(j,k,l,m){var n,o,p,q,r,s,t,u,v,w=l.serial?l.serial:Math.floor(1e16*Math.random()),x=l.name?l.name:"textAngularEditor"+w,y=function(a,c,d){b(function(){var b=function(){a.off(c,b),d()};a.on(c,b)},100)};v=e(l.taDefaultWrap),angular.extend(j,angular.copy(c),{wrapSelection:function(a,b,c){v(a,!1,b),c&&j["reApplyOnSelectorHandlerstaTextElement"+w](),j.displayElements.text[0].focus()},showHtml:!1}),l.taFocussedClass&&(j.classes.focussed=l.taFocussedClass),l.taTextEditorClass&&(j.classes.textEditor=l.taTextEditorClass),l.taHtmlEditorClass&&(j.classes.htmlEditor=l.taHtmlEditorClass),l.taTextEditorSetup&&(j.setup.textEditorSetup=j.$parent.$eval(l.taTextEditorSetup)),l.taHtmlEditorSetup&&(j.setup.htmlEditorSetup=j.$parent.$eval(l.taHtmlEditorSetup)),j.fileDropHandler=l.taFileDrop?j.$parent.$eval(l.taFileDrop):j.defaultFileDropHandler,t=k[0].innerHTML,k[0].innerHTML="",j.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},j.displayElements.popover.append(j.displayElements.popoverArrow),j.displayElements.popover.append(j.displayElements.popoverContainer),j.displayElements.scrollWindow.append(j.displayElements.popover),j.displayElements.popover.on("mousedown",function(a,b){return b&&angular.extend(a,b),a.preventDefault(),!1}),j.showPopover=function(a){j.displayElements.popover.css("display","block"),j.reflowPopover(a),i.addClass(j.displayElements.popover,"in"),y(k,"click keyup",function(){j.hidePopover()})},j.reflowPopover=function(a){j.displayElements.text[0].offsetHeight-51>a[0].offsetTop?(j.displayElements.popover.css("top",a[0].offsetTop+a[0].offsetHeight+"px"),j.displayElements.popover.removeClass("top").addClass("bottom")):(j.displayElements.popover.css("top",a[0].offsetTop-54+"px"),j.displayElements.popover.removeClass("bottom").addClass("top"));var b=j.displayElements.text[0].offsetWidth-j.displayElements.popover[0].offsetWidth,c=a[0].offsetLeft+a[0].offsetWidth/2-j.displayElements.popover[0].offsetWidth/2;j.displayElements.popover.css("left",Math.max(0,Math.min(b,c))+"px"),j.displayElements.popoverArrow.css("margin-left",Math.min(c,Math.max(0,c-b))-11+"px")},j.hidePopover=function(){i.removeClass(j.displayElements.popover,"in",function(){j.displayElements.popover.css("display",""),j.displayElements.popoverContainer.attr("style",""),j.displayElements.popoverContainer.attr("class","popover-content")})},j.displayElements.resize.overlay.append(j.displayElements.resize.background),angular.forEach(j.displayElements.resize.anchors,function(a){j.displayElements.resize.overlay.append(a)}),j.displayElements.resize.overlay.append(j.displayElements.resize.info),j.displayElements.scrollWindow.append(j.displayElements.resize.overlay),j.reflowResizeOverlay=function(a){a=angular.element(a)[0],j.displayElements.resize.overlay.css({display:"block",left:a.offsetLeft-5+"px",top:a.offsetTop-5+"px",width:a.offsetWidth+10+"px",height:a.offsetHeight+10+"px"}),j.displayElements.resize.info.text(a.offsetWidth+" x "+a.offsetHeight)},j.showResizeOverlay=function(a){var b=function(b){var c={width:parseInt(a.attr("width")),height:parseInt(a.attr("height")),x:b.clientX,y:b.clientY};void 0===c.width&&(c.width=a[0].offsetWidth),void 0===c.height&&(c.height=a[0].offsetHeight),j.hidePopover();var d=c.height/c.width,e=function(b){var e={x:Math.max(0,c.width+(b.clientX-c.x)),y:Math.max(0,c.height+(b.clientY-c.y))},f=function(a,b){a=angular.element(a),"img"===a[0].tagName.toLowerCase()&&(b.height&&(a.attr("height",b.height),delete b.height),b.width&&(a.attr("width",b.width),delete b.width)),a.css(b)};if(b.shiftKey){var g=e.y/e.x;f(a,{width:d>g?e.x:e.y/d,height:d>g?e.x*d:e.y})}else f(a,{width:e.x,height:e.y});j.reflowResizeOverlay(a)};h.find("body").on("mousemove",e),y(j.displayElements.resize.overlay,"mouseup",function(){h.find("body").off("mousemove",e),j.showPopover(a)}),b.stopPropagation(),b.preventDefault()};j.displayElements.resize.anchors[3].on("mousedown",b),j.reflowResizeOverlay(a),y(k,"click",function(){j.hideResizeOverlay()})},j.hideResizeOverlay=function(){j.displayElements.resize.overlay.css("display","")},j.setup.htmlEditorSetup(j.displayElements.html),j.setup.textEditorSetup(j.displayElements.text),j.displayElements.html.attr({id:"taHtmlElement"+w,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html"}),j.displayElements.text.attr({id:"taTextElement"+w,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html"}),j.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),l.taDefaultWrap&&j.displayElements.text.attr("ta-default-wrap",l.taDefaultWrap),l.taUnsafeSanitizer&&(j.displayElements.text.attr("ta-unsafe-sanitizer",l.taUnsafeSanitizer),j.displayElements.html.attr("ta-unsafe-sanitizer",l.taUnsafeSanitizer)),j.displayElements.scrollWindow.append(j.displayElements.text),k.append(j.displayElements.scrollWindow),k.append(j.displayElements.html),j.displayElements.forminput.attr("name",x),k.append(j.displayElements.forminput),l.tabindex&&(k.removeAttr("tabindex"),j.displayElements.text.attr("tabindex",l.tabindex),j.displayElements.html.attr("tabindex",l.tabindex)),l.placeholder&&(j.displayElements.text.attr("placeholder",l.placeholder),j.displayElements.html.attr("placeholder",l.placeholder)),l.taDisabled&&(j.displayElements.text.attr("ta-readonly","disabled"),j.displayElements.html.attr("ta-readonly","disabled"),j.disabled=j.$parent.$eval(l.taDisabled),j.$parent.$watch(l.taDisabled,function(a){j.disabled=a,j.disabled?k.addClass(j.classes.disabled):k.removeClass(j.classes.disabled)})),a(j.displayElements.scrollWindow)(j),a(j.displayElements.html)(j),j.updateTaBindtaTextElement=j["updateTaBindtaTextElement"+w],j.updateTaBindtaHtmlElement=j["updateTaBindtaHtmlElement"+w],k.addClass("ta-root"),j.displayElements.scrollWindow.addClass("ta-text ta-editor "+j.classes.textEditor),j.displayElements.html.addClass("ta-html ta-editor "+j.classes.htmlEditor),j._actionRunning=!1;var z=!1;if(j.startAction=function(){return j._actionRunning=!0,g.rangy&&g.rangy.saveSelection?(z=g.rangy.saveSelection(),function(){z&&g.rangy.restoreSelection(z)}):void 0},j.endAction=function(){j._actionRunning=!1,z&&g.rangy.removeMarkers(z),z=!1,j.updateSelectedStyles(),j.showHtml||j["updateTaBindtaTextElement"+w]()},r=function(){k.addClass(j.classes.focussed),u.focus(),k.triggerHandler("focus")},j.displayElements.html.on("focus",r),j.displayElements.text.on("focus",r),s=function(a){return j._actionRunning||h[0].activeElement===j.displayElements.html[0]||h[0].activeElement===j.displayElements.text[0]||(k.removeClass(j.classes.focussed),u.unfocus(),b(function(){k.triggerHandler("blur")},0)),a.preventDefault(),!1},j.displayElements.html.on("blur",s),j.displayElements.text.on("blur",s),j.queryFormatBlockState=function(a){return!j.showHtml&&a.toLowerCase()===h[0].queryCommandValue("formatBlock").toLowerCase()},j.queryCommandState=function(a){return j.showHtml?"":h[0].queryCommandState(a)},j.switchView=function(){j.showHtml=!j.showHtml,i.enabled(!1,j.displayElements.html),i.enabled(!1,j.displayElements.text),j.showHtml?b(function(){return i.enabled(!0,j.displayElements.html),i.enabled(!0,j.displayElements.text),j.displayElements.html[0].focus()},100):b(function(){return i.enabled(!0,j.displayElements.html),i.enabled(!0,j.displayElements.text),j.displayElements.text[0].focus()},100)},l.ngModel){var A=!0;m.$render=function(){if(A){A=!1;var a=j.$parent.$eval(l.ngModel);void 0!==a&&null!==a||!t||""===t||m.$setViewValue(t)}j.displayElements.forminput.val(m.$viewValue),j._elementSelectTriggered||h[0].activeElement===j.displayElements.html[0]||h[0].activeElement===j.displayElements.text[0]||(j.html=m.$viewValue||"")};var B=function(a){return l.required&&m.$setValidity("required",!(!a||""===a.trim())),a};m.$parsers.push(B),m.$formatters.push(B)}else j.displayElements.forminput.val(t),j.html=t;if(j.$watch("html",function(a,b){a!==b&&(l.ngModel&&m.$viewValue!==a&&m.$setViewValue(a),j.displayElements.forminput.val(a))}),l.taTargetToolbars)u=f.registerEditor(x,j,l.taTargetToolbars.split(","));else{var C=angular.element('<div text-angular-toolbar name="textAngularToolbar'+w+'">');l.taToolbar&&C.attr("ta-toolbar",l.taToolbar),l.taToolbarClass&&C.attr("ta-toolbar-class",l.taToolbarClass),l.taToolbarGroupClass&&C.attr("ta-toolbar-group-class",l.taToolbarGroupClass),l.taToolbarButtonClass&&C.attr("ta-toolbar-button-class",l.taToolbarButtonClass),l.taToolbarActiveButtonClass&&C.attr("ta-toolbar-active-button-class",l.taToolbarActiveButtonClass),l.taFocussedClass&&C.attr("ta-focussed-class",l.taFocussedClass),k.prepend(C),a(C)(j.$parent),u=f.registerEditor(x,j,["textAngularToolbar"+w])}var D=function(){f.unregisterEditor(x)};j.$on("$destroy",D),k.on("$destroy",D),j.$on("ta-element-select",function(a,b){u.triggerElementSelect(a,b)}),j._bUpdateSelectedStyles=!1,j.updateSelectedStyles=function(){var a;void 0!==(a=d.getSelectionElement())&&a.parentNode!==j.displayElements.text[0]?u.updateSelectedStyles(angular.element(a)):u.updateSelectedStyles(),j._bUpdateSelectedStyles&&b(j.updateSelectedStyles,200)},n=function(){j._bUpdateSelectedStyles||(j._bUpdateSelectedStyles=!0,j.$apply(function(){j.updateSelectedStyles()}))},j.displayElements.html.on("keydown",n),j.displayElements.text.on("keydown",n),o=function(){j._bUpdateSelectedStyles=!1},j.displayElements.html.on("keyup",o),j.displayElements.text.on("keyup",o),p=function(a,b){b&&angular.extend(a,b),j.$apply(function(){return u.sendKeyCommand(a)?(j._bUpdateSelectedStyles||j.updateSelectedStyles(),a.preventDefault(),!1):void 0})},j.displayElements.html.on("keypress",p),j.displayElements.text.on("keypress",p),q=function(){j._bUpdateSelectedStyles=!1,j.$apply(function(){j.updateSelectedStyles()})},j.displayElements.html.on("mouseup",q),j.displayElements.text.on("mouseup",q)}}}]).factory("taBrowserTag",[function(){return function(a){return a?""===a?void 0===e?"div":8>=e?"P":"p":8>=e?a.toUpperCase():a:8>=e?"P":"p"}}]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(a,b,c){var d=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/gi,e=/^(ul|li|ol)$/gi,f=function(b,c){var d,e,f=b.find("li");for(e=f.length-1;e>=0;e--)d=angular.element("<"+c+">"+f[e].innerHTML+"</"+c+">"),b.after(d);b.remove(),a.setSelectionToElementEnd(d[0])},g=function(b,c){var d=angular.element("<"+c+">"+b[0].innerHTML+"</"+c+">");b.after(d),b.remove(),a.setSelectionToElementEnd(d.find("li")[0])},h=function(c,d,e){for(var f="",g=0;g<c.length;g++)f+="<"+b("li")+">"+c[g].innerHTML+"</"+b("li")+">";var h=angular.element("<"+e+">"+f+"</"+e+">");d.after(h),d.remove(),a.setSelectionToElementEnd(h.find("li")[0])};return function(i){return i=b(i),function(j,k,l){var m,n,o,p,q,r,s=angular.element("<"+i+">"),t=a.getSelectionElement(),u=angular.element(t);if(void 0!==t){var v=t.tagName.toLowerCase();if("insertorderedlist"===j.toLowerCase()||"insertunorderedlist"===j.toLowerCase()){var w=b("insertorderedlist"===j.toLowerCase()?"ol":"ul");if(v===w)return f(u,i);if("li"===v&&u.parent()[0].tagName.toLowerCase()===w&&1===u.parent().children().length)return f(u.parent(),i);if("li"===v&&u.parent()[0].tagName.toLowerCase()!==w&&1===u.parent().children().length)return g(u.parent(),w);if(v.match(d)&&!u.hasClass("ta-bind")){if("ol"===v||"ul"===v)return g(u,w);var x=!1;return angular.forEach(u.children(),function(a){a.tagName.match(d)&&(x=!0)}),x?h(u.children(),u,w):h([angular.element("<div>"+t.innerHTML+"</div>")[0]],u,w)}if(v.match(d)){if(p=a.getOnlySelectedElements(),1===p.length&&("ol"===p[0].tagName.toLowerCase()||"ul"===p[0].tagName.toLowerCase()))return p[0].tagName.toLowerCase()===w?f(angular.element(p[0]),i):g(angular.element(p[0]),w);o="";var y=[];for(m=0;m<p.length;m++)if(3!==p[m].nodeType){var z=angular.element(p[m]);o+="<"+b("li")+">"+z[0].innerHTML+"</"+b("li")+">",y.unshift(z)}return n=angular.element("<"+w+">"+o+"</"+w+">"),y.pop().replaceWith(n),angular.forEach(y,function(a){a.remove()}),void a.setSelectionToElementEnd(n[0])}}else if("formatblock"===j.toLowerCase()){for(r=l.toLowerCase().replace(/[<>]/gi,""),n="li"===v?u.parent():u;!n[0].tagName.match(d);)n=n.parent(),v=n[0].tagName.toLowerCase();if(v===r){p=n.children();var A=!1;for(m=0;m<p.length;m++)A=A||p[m].tagName.match(d);A?(n.after(p),q=n.next(),n.remove(),n=q):(s.append(n[0].childNodes),n.after(s),n.remove(),n=s)}else if(n.parent()[0].tagName.toLowerCase()!==r||n.parent().hasClass("ta-bind"))if(v.match(e))n.wrap(l);else{p=a.getOnlySelectedElements(),0===p.length&&(p=[n[0]]);var B=!1;if(angular.forEach(p,function(a){3!==a.nodeType&&a.tagName.match(d)||(B=!0)}),B)for(;3===p[0].nodeType||!p[0].tagName.match(d);)p=[p[0].parentNode];if(angular.element(p[0]).hasClass("ta-bind"))n=angular.element(l),n[0].innerHTML=p[0].innerHTML,p[0].innerHTML=n[0].outerHTML;else if("blockquote"===r){for(o="",m=0;m<p.length;m++)o+=p[m].outerHTML;n=angular.element(l),n[0].innerHTML=o,p[0].parentNode.insertBefore(n[0],p[0]),angular.forEach(p,function(a){a.parentNode.removeChild(a)})}else for(m=0;m<p.length;m++)n=angular.element(l),n[0].innerHTML=p[m].innerHTML,p[m].parentNode.insertBefore(n[0],p[m]),p[m].parentNode.removeChild(p[m])}else{var C=n.parent(),D=C.contents();for(m=0;m<D.length;m++)C.parent().hasClass("ta-bind")&&3===D[m].nodeType&&(s=angular.element("<"+i+">"),s[0].innerHTML=D[m].outerHTML,D[m]=s[0]),C.parent()[0].insertBefore(D[m],C[0]);C.remove()}return void a.setSelectionToElementEnd(n[0])}}try{c[0].execCommand(j,k,l)}catch(E){}}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taBrowserTag","taSelection","taOptions",function(a,b,c,f,i,j,k){return{require:"ngModel",link:function(i,l,m,n){var o,p,q,r=void 0!==l.attr("contenteditable")&&l.attr("contenteditable"),s=r||"textarea"===l[0].tagName.toLowerCase()||"input"===l[0].tagName.toLowerCase(),t=!1,u=!1,v=m.taUnsafeSanitizer||k.disableSanitizer,w=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|46|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/;void 0===m.taDefaultWrap&&(m.taDefaultWrap="p"),""===m.taDefaultWrap?(o="",p=void 0===e?"<div><br></div>":e>=11?"<p><br></p>":8>=e?"<P>&nbsp;</P>":"<p>&nbsp;</p>",q=void 0===e?/^<div>(\s|&nbsp;)*<\/div>$/gi:/^<p>(\s|&nbsp;)*<\/p>$/gi):(o=void 0===e||e>=11?"<"+m.taDefaultWrap+"><br></"+m.taDefaultWrap+">":8>=e?"<"+m.taDefaultWrap.toUpperCase()+"></"+m.taDefaultWrap.toUpperCase()+">":"<"+m.taDefaultWrap+"></"+m.taDefaultWrap+">",p=void 0===e||e>=11?"<"+m.taDefaultWrap+"><br></"+m.taDefaultWrap+">":8>=e?"<"+m.taDefaultWrap.toUpperCase()+">&nbsp;</"+m.taDefaultWrap.toUpperCase()+">":"<"+m.taDefaultWrap+">&nbsp;</"+m.taDefaultWrap+">",q=new RegExp("^<"+m.taDefaultWrap+">(\\s|&nbsp;)*<\\/"+m.taDefaultWrap+">$","ig")),l.addClass("ta-bind");var x=function(){if(r)return l[0].innerHTML;if(s)return l.val();throw"textAngular Error: attempting to update non-editable taBind"},y=function(a){a||(a=x()),a===p||a.match(q)?""!==n.$viewValue&&n.$setViewValue(""):n.$viewValue!==a&&n.$setViewValue(a)};if(i["updateTaBind"+(m.id||"")]=function(){t||y()},s)if(l.on("paste",function(b,d){d&&angular.extend(b,d);var e;return b.clipboardData||b.originalEvent&&b.originalEvent.clipboardData?e=(b.originalEvent||b).clipboardData.getData("text/plain"):c.clipboardData&&(e=c.clipboardData.getData("Text")),e||t?(b.preventDefault(),void(t||(e=a(e),j.insertHtml(e)))):!0}),l.on("paste cut",function(a){t?a.preventDefault():b(function(){n.$setViewValue(x())},0)}),r){if(l.on("keyup",function(a,b){if(b&&angular.extend(a,b),!t&&!w.test(a.keyCode)){if(""!==o&&13===a.keyCode&&!a.shiftKey){for(var c=j.getSelectionElement(),d=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/gi;!c.tagName.match(d)&&c!==l[0];)c=c.parentNode;if(c.tagName.toLowerCase()!==m.taDefaultWrap&&"li"!==c.tagName.toLowerCase()&&(""===c.innerHTML.trim()||"<br>"===c.innerHTML.trim())){var e=angular.element(o);angular.element(c).replaceWith(e),j.setSelectionToElementStart(e[0])}}var f=x();""!==o&&""===f.trim()&&(l[0].innerHTML=o,j.setSelectionToElementStart(l.children()[0])),y(f)}}),l.on("blur",function(){u=!1,t||y(),n.$render()}),m.placeholder&&(e>8||void 0===e)){var z;if(!m.id)throw"textAngular Error: An unique ID is required for placeholders to work";z=g("#"+m.id+".placeholder-text:before",'content: "'+m.placeholder+'"'),i.$on("$destroy",function(){h(z)})}l.on("focus",function(){u=!0,n.$render()}),l.on("mousedown",function(a,b){b&&angular.extend(a,b),a.stopPropagation()})}else l.on("change blur",function(){t||n.$setViewValue(x())});var A=function(b){return n.$oldViewValue=a(b,n.$oldViewValue,v)},B=function(a){return m.required&&n.$setValidity("required",!(!a||a.trim()===p||a.trim().match(q)||""===a.trim())),a};n.$parsers.push(A),n.$parsers.push(B),n.$formatters.push(A),n.$formatters.push(B);var C=function(a){l[0].innerHTML=a};n.$render=function(){var a=n.$viewValue||"";f[0].activeElement!==l[0]?r?m.placeholder?""===a?(u?l.removeClass("placeholder-text"):l.addClass("placeholder-text"),C(o)):(l.removeClass("placeholder-text"),C(a)):C(""===a?o:a):"textarea"!==l[0].tagName.toLowerCase()&&"input"!==l[0].tagName.toLowerCase()||l.val(a):r&&l.removeClass("placeholder-text")},m.taReadonly&&(t=i.$eval(m.taReadonly),t?(l.addClass("ta-readonly"),("textarea"===l[0].tagName.toLowerCase()||"input"===l[0].tagName.toLowerCase())&&l.attr("disabled","disabled"),void 0!==l.attr("contenteditable")&&l.attr("contenteditable")&&l.removeAttr("contenteditable")):(l.removeClass("ta-readonly"),"textarea"===l[0].tagName.toLowerCase()||"input"===l[0].tagName.toLowerCase()?l.removeAttr("disabled"):r&&l.attr("contenteditable","true")),i.$watch(m.taReadonly,function(a,b){b!==a&&(a?(l.addClass("ta-readonly"),("textarea"===l[0].tagName.toLowerCase()||"input"===l[0].tagName.toLowerCase())&&l.attr("disabled","disabled"),void 0!==l.attr("contenteditable")&&l.attr("contenteditable")&&l.removeAttr("contenteditable")):(l.removeClass("ta-readonly"),"textarea"===l[0].tagName.toLowerCase()||"input"===l[0].tagName.toLowerCase()?l.removeAttr("disabled"):r&&l.attr("contenteditable","true")),t=a)})),r&&!t&&l.on("blur",function(){/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&(d=!0)})}}}]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){var b=angular.element("<div/>");b.html(a);var c=b.text().length;return f>=c?(d.$setValidity("taMaxText",!0),a):void d.$setValidity("taMaxText",!1)}var f=parseInt(a.$eval(c.taMaxText));if(isNaN(f))throw"Max text must be an integer";c.$observe("taMaxText",function(a){if(f=parseInt(a),isNaN(f))throw"Max text must be an integer";d.$dirty&&d.$setViewValue(d.$viewValue)}),d.$parsers.unshift(e)}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){var b=angular.element("<div/>");b.html(a);var c=b.text().length;return!c||c>=f?(d.$setValidity("taMinText",!0),a):void d.$setValidity("taMinText",!1)}var f=parseInt(a.$eval(c.taMinText));if(isNaN(f))throw"Min text must be an integer";c.$observe("taMinText",function(a){if(f=parseInt(a),isNaN(f))throw"Min text must be an integer";d.$dirty&&d.$setViewValue(d.$viewValue)}),d.$parsers.unshift(e)}}}).factory("taSanitize",["$sanitize",function(a){return function(c,d,e){var f=angular.element("<div>"+c+"</div>");angular.forEach(b(f,"align"),function(a){a.css("text-align",a.attr("align")),a.removeAttr("align")});var g;c=f[0].innerHTML;try{g=a(c),e&&(g=c)}catch(h){g=d||""}return g}}]).directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(a,b,c,d,e,f){return{scope:{name:"@"},restrict:"EA",link:function(g,h,i){if(!g.name||""===g.name)throw"textAngular Error: A toolbar requires a name";angular.extend(g,angular.copy(c)),i.taToolbar&&(g.toolbar=g.$parent.$eval(i.taToolbar)),i.taToolbarClass&&(g.classes.toolbar=i.taToolbarClass),i.taToolbarGroupClass&&(g.classes.toolbarGroup=i.taToolbarGroupClass),i.taToolbarButtonClass&&(g.classes.toolbarButton=i.taToolbarButtonClass),i.taToolbarActiveButtonClass&&(g.classes.toolbarButtonActive=i.taToolbarActiveButtonClass),i.taFocussedClass&&(g.classes.focussed=i.taFocussedClass),g.disabled=!0,g.focussed=!1,g._$element=h,h[0].innerHTML="",h.addClass("ta-toolbar "+g.classes.toolbar),g.$watch("focussed",function(){g.focussed?h.addClass(g.classes.focussed):h.removeClass(g.classes.focussed)});var j=function(b,c){var d;if(d=angular.element(b&&b.display?b.display:"<button type='button'>"),d.addClass(b&&b["class"]?b["class"]:g.classes.toolbarButton),d.attr("name",c.name),d.attr("unselectable","on"),d.attr("ng-disabled","isDisabled()"),d.attr("tabindex","-1"),d.attr("ng-click","executeAction()"),d.attr("ng-class","displayActiveToolClass(active)"),b&&b.tooltiptext&&d.attr("title",b.tooltiptext),d.on("mousedown",function(a,b){return b&&angular.extend(a,b),a.preventDefault(),!1}),b&&!b.display&&!c._display&&(d[0].innerHTML="",b.buttontext&&(d[0].innerHTML=b.buttontext),b.iconclass)){var e=angular.element("<i>"),f=d[0].innerHTML;e.addClass(b.iconclass),d[0].innerHTML="",d.append(e),f&&""!==f&&d.append("&nbsp;"+f)}return c._lastToolDefinition=angular.copy(b),a(d)(c)};g.tools={},g._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var k={$window:f,$editor:function(){return g._parent},isDisabled:function(){return"function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(a){return a?g.classes.toolbarButtonActive:""},executeAction:e};angular.forEach(g.toolbar,function(a){var b=angular.element("<div>");b.addClass(g.classes.toolbarGroup),angular.forEach(a,function(a){g.tools[a]=angular.extend(g.$new(!0),d[a],k,{name:a}),g.tools[a].$element=j(d[a],g.tools[a]),b.append(g.tools[a].$element)}),h.append(b)}),g.updateToolDisplay=function(a,b,c){var d=g.tools[a];if(d){if(d._lastToolDefinition&&!c&&(b=angular.extend({},d._lastToolDefinition,b)),null===b.buttontext&&null===b.iconclass&&null===b.display)throw'textAngular Error: Tool Definition for updating "'+a+'" does not have a valid display/iconclass/buttontext value';null===b.buttontext&&delete b.buttontext,null===b.iconclass&&delete b.iconclass,null===b.display&&delete b.display;var e=j(b,d);d.$element.replaceWith(e),d.$element=e}},g.addTool=function(a,b,c,e){g.tools[a]=angular.extend(g.$new(!0),d[a],k,{name:a}),g.tools[a].$element=j(d[a],g.tools[a]);var f;void 0===c&&(c=g.toolbar.length-1),f=angular.element(h.children()[c]),void 0===e?(f.append(g.tools[a].$element),g.toolbar[c][g.toolbar[c].length-1]=a):(f.children().eq(e).after(g.tools[a].$element),g.toolbar[c][e]=a)},b.registerToolbar(g);var l=function(){b.unregisterToolbar(g.name)};g.$on("$destroy",l),h.on("$destroy",l)}}}]).service("taToolExecuteAction",["$q","$log",function(a,b){return function(c){void 0!==c&&(this.$editor=function(){return c});var d=a.defer(),e=d.promise,f=this.$editor();e["finally"](function(){f.endAction.call(f)});var g;try{g=this.action(d,f.startAction())}catch(h){b.error(h)}(g||void 0===g)&&d.resolve()}}]).service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(a,b,c){var d={},e={};return{registerEditor:function(c,f,g){if(!c||""===c)throw"textAngular Error: An editor requires a name";if(!f)throw"textAngular Error: An editor requires a scope";if(e[c])throw'textAngular Error: An Editor with name "'+c+'" already exists';var h=[];return angular.forEach(g,function(a){d[a]&&h.push(d[a])}),e[c]={scope:f,toolbars:g,_registerToolbar:function(a){this.toolbars.indexOf(a.name)>=0&&h.push(a)
},editorFunctions:{disable:function(){angular.forEach(h,function(a){a.disabled=!0})},enable:function(){angular.forEach(h,function(a){a.disabled=!1})},focus:function(){angular.forEach(h,function(a){a._parent=f,a.disabled=!1,a.focussed=!0})},unfocus:function(){angular.forEach(h,function(a){a.disabled=!0,a.focussed=!1})},updateSelectedStyles:function(a){angular.forEach(h,function(b){angular.forEach(b.tools,function(c){c.activeState&&(b._parent=f,c.active=c.activeState(a))})})},sendKeyCommand:function(c){var d=!1;return(c.ctrlKey||c.metaKey)&&angular.forEach(b,function(b,e){if(b.commandKeyCode&&b.commandKeyCode===c.which)for(var g=0;g<h.length;g++)if(void 0!==h[g].tools[e]){a.call(h[g].tools[e],f),d=!0;break}}),d},triggerElementSelect:function(a,c){var d=function(a,b){for(var c=!0,d=0;d<b.length;d++)c=c&&a.attr(b[d]);return c},e=[],g={},i=!1;c=angular.element(c);var j=!1;if(angular.forEach(b,function(a,b){a.onElementSelect&&a.onElementSelect.element&&a.onElementSelect.element.toLowerCase()===c[0].tagName.toLowerCase()&&(!a.onElementSelect.filter||a.onElementSelect.filter(c))&&(j=j||angular.isArray(a.onElementSelect.onlyWithAttrs)&&d(c,a.onElementSelect.onlyWithAttrs),(!a.onElementSelect.onlyWithAttrs||d(c,a.onElementSelect.onlyWithAttrs))&&(g[b]=a))}),j?(angular.forEach(g,function(a,b){a.onElementSelect.onlyWithAttrs&&d(c,a.onElementSelect.onlyWithAttrs)&&e.push({name:b,tool:a})}),e.sort(function(a,b){return b.tool.onElementSelect.onlyWithAttrs.length-a.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(g,function(a,b){e.push({name:b,tool:a})}),e.length>0)for(var k=0;k<e.length;k++){for(var l=e[k].tool,m=e[k].name,n=0;n<h.length;n++)if(void 0!==h[n].tools[m]){l.onElementSelect.action.call(h[n].tools[m],a,c,f),i=!0;break}if(i)break}return i}}},e[c].editorFunctions},retrieveEditor:function(a){return e[a]},unregisterEditor:function(a){delete e[a]},registerToolbar:function(a){if(!a)throw"textAngular Error: A toolbar requires a scope";if(!a.name||""===a.name)throw"textAngular Error: A toolbar requires a name";if(d[a.name])throw'textAngular Error: A toolbar with name "'+a.name+'" already exists';d[a.name]=a,angular.forEach(e,function(b){b._registerToolbar(a)})},retrieveToolbar:function(a){return d[a]},retrieveToolbarsViaEditor:function(a){var b=[],c=this;return angular.forEach(this.retrieveEditor(a).toolbars,function(a){b.push(c.retrieveToolbar(a))}),b},unregisterToolbar:function(a){delete d[a]},updateToolsDisplay:function(a){var b=this;angular.forEach(a,function(a,c){b.updateToolDisplay(c,a)})},resetToolsDisplay:function(){var a=this;angular.forEach(b,function(b,c){a.resetToolDisplay(c)})},updateToolDisplay:function(a,b){var c=this;angular.forEach(d,function(d,e){c.updateToolbarToolDisplay(e,a,b)})},resetToolDisplay:function(a){var b=this;angular.forEach(d,function(c,d){b.resetToolbarToolDisplay(d,a)})},updateToolbarToolDisplay:function(a,b,c){if(!d[a])throw'textAngular Error: No Toolbar with name "'+a+'" exists';d[a].updateToolDisplay(b,c)},resetToolbarToolDisplay:function(a,c){if(!d[a])throw'textAngular Error: No Toolbar with name "'+a+'" exists';d[a].updateToolDisplay(c,b[c],!0)},removeTool:function(a){delete b[a],angular.forEach(d,function(b){delete b.tools[a];for(var c=0;c<b.toolbar.length;c++){for(var d,e=0;e<b.toolbar[c].length;e++){if(b.toolbar[c][e]===a){d={group:c,index:e};break}if(void 0!==d)break}void 0!==d&&(b.toolbar[d.group].slice(d.index,1),b._$element.children().eq(d.group).children().eq(d.index).remove())}})},addTool:function(a,b,e,f){c(a,b),angular.forEach(d,function(c){c.addTool(a,b,e,f)})},addToolToToolbar:function(a,b,e,f,g){c(a,b),d[e].addTool(a,b,f,g)},refreshEditor:function(a){if(!e[a])throw'textAngular Error: No Editor with name "'+a+'" exists';e[a].scope.updateTaBindtaTextElement(),e[a].scope.$$phase||e[a].scope.$digest()}}}]).service("taSelection",["$window","$document",function(a,b){var c=b[0],d=function(a){if(a.hasChildNodes())return a.firstChild;for(;a&&!a.nextSibling;)a=a.parentNode;return a?a.nextSibling:null},e=function(a){var b=a.startContainer,c=a.endContainer;if(b===c)return[b];for(var e=[];b&&b!==c;)b=d(b),b.parentNode===a.commonAncestorContainer&&e.push(b);for(b=a.startContainer;b&&b!==a.commonAncestorContainer;)b.parentNode===a.commonAncestorContainer&&e.unshift(b),b=b.parentNode;return e};return{getSelection:function(){var b,d,e;return c.selection&&c.selection.createRange?(b=c.selection.createRange(),e=b.parentElement(),d={isCollapsed:0===b.text.length}):a.getSelection&&(d=a.getSelection(),d.getRangeAt?d.rangeCount>0&&(b=d.getRangeAt(0)):(b=c.createRange(),b.setStart(d.anchorNode,d.anchorOffset),b.setEnd(d.focusNode,d.focusOffset),b.collapsed!==d.isCollapsed&&(b.setStart(d.focusNode,d.focusOffset),b.setEnd(d.anchorNode,d.anchorOffset))),b&&(e=b.commonAncestorContainer,e=3===e.nodeType?e.parentNode:e)),b?{start:{element:b.startContainer,offset:b.startOffset},end:{element:b.endContainer,offset:b.endOffset},container:e,collapsed:d.isCollapsed}:{start:{offset:0},end:{offset:0},container:void 0,collapsed:!0}},getOnlySelectedElements:function(){if(window.getSelection){var b=a.getSelection();if(!b.isCollapsed)return e(b.getRangeAt(0))}return[]},getSelectionElement:function(){return this.getSelection().container},setSelection:function(b,d,e){if(c.createRange&&a.getSelection){var f=c.createRange();f.selectNodeContents(b),f.setStart(b,d),f.setEnd(b,e);var g=a.getSelection();g.removeAllRanges(),g.addRange(f)}else if(c.selection&&c.body.createTextRange){var h=c.body.createTextRange();h.moveToElementText(b),h.moveEnd("character",d),h.moveStart("character",e),h.select()}},setSelectionToElementStart:function(b){if(c.createRange&&a.getSelection){var d=c.createRange();d.selectNodeContents(b),d.setStart(b,0),d.setEnd(b,0);var e=a.getSelection();e.removeAllRanges(),e.addRange(d)}else if(c.selection&&c.body.createTextRange){var f=c.body.createTextRange();f.moveToElementText(b),f.collapse(!0),f.moveEnd("character",0),f.moveStart("character",0),f.select()}},setSelectionToElementEnd:function(b){if(c.createRange&&a.getSelection){var d=c.createRange();d.selectNodeContents(b),d.collapse(!1);var e=a.getSelection();e.removeAllRanges(),e.addRange(d)}else if(c.selection&&c.body.createTextRange){var f=c.body.createTextRange();f.moveToElementText(b),f.collapse(!1),f.select()}},insertHtml:function(a){var b,c;if(window.getSelection){if(b=window.getSelection(),b.getRangeAt&&b.rangeCount){c=b.getRangeAt(0),c.deleteContents();var d=document.createElement("div");d.innerHTML=a;for(var e,f,g=document.createDocumentFragment();e=d.firstChild;)f=g.appendChild(e);c.insertNode(g),f&&(c=c.cloneRange(),c.setStartAfter(f),c.collapse(!0),b.removeAllRanges(),b.addRange(c))}}else document.selection&&"Control"!==document.selection.type&&document.selection.createRange().pasteHTML(a)}}}])}()}({},function(){return this}());